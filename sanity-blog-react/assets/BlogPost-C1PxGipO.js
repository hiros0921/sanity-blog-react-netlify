import{r as m,j as e,M as S,A as v,m as h,aa as P,f as L,ab as $,ac as B,H as I,R as E,c as q,a as A,ad as z,ae as F,af as R,L as _,ag as O}from"./react-vendor-CeN1yosF.js";import{u as f,c as H}from"./sanity-BKlHiFMk.js";import{E as M}from"./EnhancedSEO-B35uikUk.js";import{O as C}from"./OptimizedImage-D7BCwoN9.js";import{a as Z}from"./index-cbB5AewJ.js";import{u as W,a as Q}from"./bookmarks-CJdUwcE9.js";function U({postId:t}){const{comments:a,postComment:x,likeComment:u}=Z(t),[g,s]=m.useState(!1),[i,o]=m.useState(null),[r,d]=m.useState({name:"",email:"",content:""}),[c,p]=m.useState(!1),n=async(l,y)=>{if(l.preventDefault(),!(!r.name||!r.email||!r.content)){p(!0);try{await x({author:{name:r.name,email:r.email,avatar:`https://api.dicebear.com/7.x/avataaars/svg?seed=${r.email}`},content:r.content,status:"pending",parentId:y}),d({name:"",email:"",content:""}),s(!1),o(null)}catch(w){console.error("Failed to post comment:",w)}finally{p(!1)}}},j=a.filter(l=>l.status==="approved"),k=a.filter(l=>l.status==="pending");return e.jsxs("div",{className:"mt-16 border-t border-gray-200 dark:border-gray-700 pt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(S,{className:"w-6 h-6"}),"コメント (",j.length,")"]}),e.jsxs("button",{onClick:()=>s(!g),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),"コメントを書く"]})]}),e.jsx(v,{children:g&&e.jsx(h.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-8",children:e.jsxs("form",{onSubmit:l=>n(l),className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"お名前 *"}),e.jsx("input",{type:"text",value:r.name,onChange:l=>d({...r,name:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"メールアドレス *"}),e.jsx("input",{type:"email",value:r.email,onChange:l=>d({...r,email:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"コメント *"}),e.jsx("textarea",{value:r.content,onChange:l=>d({...r,content:l.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white resize-none",placeholder:"コメントを入力してください...",required:!0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"* 必須項目。メールアドレスは公開されません。"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>s(!1),className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200",children:"キャンセル"}),e.jsxs("button",{type:"submit",disabled:c,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),c?"送信中...":"送信"]})]})]})]})})}),k.length>0&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"あなたのコメントは承認待ちです。承認後に表示されます。"})}),e.jsx("div",{className:"space-y-6",children:j.length===0?e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"まだコメントがありません。最初のコメントを投稿してみましょう！"}):j.map(l=>e.jsx(T,{comment:l,onReply:y=>o(y),onLike:u,replyingTo:i,onSubmitReply:y=>n(y,l.id),formData:r,setFormData:d,setReplyingTo:o,isSubmitting:c},l.id))})]})}function T({comment:t,onReply:a,onLike:x,replyingTo:u,onSubmitReply:g,formData:s,setFormData:i,setReplyingTo:o,isSubmitting:r,isReply:d=!1}){const[c,p]=m.useState(!1);return e.jsx(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`${d?"ml-12":""}`,children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("img",{src:t.author.avatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${t.author.email}`,alt:t.author.name,className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:t.author.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:L(new Date(t.createdAt),{addSuffix:!0,locale:q})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>p(!c),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded",children:e.jsx($,{className:"w-4 h-4 text-gray-500"})}),c&&e.jsx("div",{className:"absolute right-0 mt-1 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-10",children:e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"報告"]})})]})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:t.content})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("button",{onClick:()=>x(t.id),className:"flex items-center gap-1 text-sm text-gray-500 hover:text-red-500 transition-colors",children:[e.jsx(I,{className:`w-4 h-4 ${t.likes>0?"fill-current text-red-500":""}`}),t.likes>0&&t.likes]}),!d&&e.jsxs("button",{onClick:()=>a(t.id),className:"flex items-center gap-1 text-sm text-gray-500 hover:text-blue-500 transition-colors",children:[e.jsx(E,{className:"w-4 h-4"}),"返信"]})]}),e.jsx(v,{children:u===t.id&&e.jsxs(h.form,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},onSubmit:g,className:"mt-4 bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsx("input",{type:"text",placeholder:"お名前",value:s.name,onChange:n=>i({...s,name:n.target.value}),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm dark:bg-gray-700 dark:text-white",required:!0}),e.jsx("input",{type:"email",placeholder:"メールアドレス",value:s.email,onChange:n=>i({...s,email:n.target.value}),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),e.jsx("textarea",{placeholder:"返信を入力...",value:s.content,onChange:n=>i({...s,content:n.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm dark:bg-gray-700 dark:text-white resize-none mb-3",required:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>o(null),className:"px-3 py-1 text-sm text-gray-600 dark:text-gray-400",children:"キャンセル"}),e.jsx("button",{type:"submit",disabled:r,className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 disabled:opacity-50",children:"返信"})]})]})}),t.replies&&t.replies.length>0&&e.jsx("div",{className:"mt-4 space-y-4",children:t.replies.map(n=>e.jsx(T,{comment:n,onReply:a,onLike:x,replyingTo:u,onSubmitReply:g,formData:s,setFormData:i,setReplyingTo:o,isSubmitting:r,isReply:!0},n.id))})]})]})})}function V({post:t,showLike:a=!0,showAddToList:x=!1,className:u=""}){const{toggleBookmark:g,toggleLike:s,readingLists:i,addToReadingList:o}=W(),{isBookmarked:r,isLiked:d,bookmark:c}=Q(t.id),[p,n]=m.useState(!1),[j,k]=m.useState(!1),l=async()=>{k(!0),await g(t),setTimeout(()=>k(!1),500)},y=async()=>{await s(t.id)},w=b=>{c&&(o(b,c.id),n(!1))};return e.jsxs("div",{className:`flex items-center gap-2 ${u}`,children:[e.jsx(h.button,{onClick:l,whileTap:{scale:.9},className:`relative p-2 rounded-lg transition-all ${r?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400"}`,children:e.jsx(v,{mode:"wait",children:j?e.jsx(h.div,{initial:{scale:0},animate:{scale:[0,1.2,1]},exit:{scale:0},transition:{duration:.3},children:e.jsx(A,{className:"w-5 h-5"})},"animating"):e.jsx(h.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},children:e.jsx(z,{className:`w-5 h-5 ${r?"fill-current":""}`})},"bookmark")})}),a&&e.jsx(h.button,{onClick:y,whileTap:{scale:.9},className:`p-2 rounded-lg transition-all ${d?"text-red-500":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400"}`,children:e.jsx(I,{className:`w-5 h-5 ${d?"fill-current":""}`})}),x&&r&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>n(!p),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg text-gray-600 dark:text-gray-400",children:e.jsx(F,{className:"w-5 h-5"})}),e.jsx(v,{children:p&&e.jsxs(e.Fragment,{children:[e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>n(!1),className:"fixed inset-0 z-40"}),e.jsxs(h.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute right-0 mt-2 w-64 bg-white dark:bg-gray-900 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 z-50 py-2",children:[e.jsx("p",{className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 border-b border-gray-200 dark:border-gray-700",children:"読書リストに追加"}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:i.length===0?e.jsx("p",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:"読書リストがありません"}):i.map(b=>{const N=c&&b.bookmarkIds.includes(c.id);return e.jsxs("button",{onClick:()=>!N&&w(b.id),disabled:N,className:`w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center justify-between ${N?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[b.icon&&e.jsx("span",{children:b.icon}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:b.name})]}),N&&e.jsx(A,{className:"w-4 h-4 text-green-500"})]},b.id)})})]})]})})]})]})}const Y=`*[_type == "post" && slug.current == $slug][0] {
  _id,
  _createdAt,
  title,
  slug,
  author->{
    _id,
    name,
    image,
    bio
  },
  mainImage,
  categories[]->{
    _id,
    title,
    slug
  },
  publishedAt,
  body
}`;function ae(){const{slug:t}=R(),[a,x]=m.useState(null),[u,g]=m.useState(!0);return m.useEffect(()=>{t&&(async()=>{try{const i=await H.fetch(Y,{slug:t});x(i)}catch(i){console.error("Error fetching post:",i),console.log("BlogPost: API error, using mock data. Slug:",t);const o={"test-post-1":{_id:"1",_createdAt:"2025-01-01T00:00:00Z",title:"テスト記事1",slug:{current:"test-post-1"},author:{_id:"1",name:"テスト著者",bio:"これはテスト著者のプロフィールです。"},publishedAt:"2025-01-01T00:00:00Z",body:[{_type:"block",children:[{_type:"span",text:"これはテスト記事の本文です。Sanity APIに接続できない場合のデモ用データですが、実際のブログと同じように表示されます。"}],style:"normal"},{_type:"block",children:[{_type:"span",text:"複数の段落も表示できます。リッチテキストエディタで作成されたコンテンツを適切に表示します。"}],style:"normal"}]},"test-post-2":{_id:"2",_createdAt:"2025-01-02T00:00:00Z",title:"テスト記事2",slug:{current:"test-post-2"},author:{_id:"1",name:"テスト著者",bio:"これはテスト著者のプロフィールです。"},publishedAt:"2025-01-02T00:00:00Z",categories:[{_id:"1",title:"テスト",slug:{current:"test"}}],body:[{_type:"block",children:[{_type:"span",text:"2つ目のテスト記事の本文です。カテゴリータグも表示されています。"}],style:"normal"}]}};console.log("Available mock posts:",Object.keys(o)),t&&o[t]?(console.log("Found mock post for slug:",t),x(o[t])):console.log("No mock post found for slug:",t)}finally{g(!1)}})()},[t]),u?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})}):a?e.jsxs(e.Fragment,{children:[e.jsx(M,{title:`${a.title} | HiroSuwa`,description:a.excerpt||`${a.title}についての詳細な解説記事です。プログラミングとWeb開発の最新情報をお届けします。`,image:a.mainImage?f(a.mainImage):void 0,type:"article",author:a.author?.name||"HiroSuwa",publishedTime:a.publishedAt,modifiedTime:a._createdAt,section:"Technology",tags:a.categories?.map(s=>s.title)||["プログラミング","Web開発"]}),e.jsxs("article",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx(_,{to:"/",className:"text-blue-600 hover:underline mb-4 inline-block",children:"← Back to posts"}),e.jsxs("header",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold",children:a.title}),e.jsx(V,{post:{id:a._id,title:a.title,slug:a.slug.current,excerpt:a.excerpt,mainImage:a.mainImage?f(a.mainImage):void 0},showAddToList:!0,className:"ml-4"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-gray-600 mb-4",children:[a.author&&e.jsxs("div",{className:"flex items-center gap-2",children:[a.author.image&&e.jsx(C,{src:f(a.author.image),alt:a.author.name,width:40,height:40,className:"w-10 h-10 rounded-full"}),e.jsxs("span",{children:["By ",a.author.name]})]}),e.jsx("time",{dateTime:a.publishedAt,children:new Date(a.publishedAt).toLocaleDateString()})]}),a.categories&&a.categories.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:a.categories.map(s=>e.jsx("span",{className:"px-3 py-1 bg-gray-200 text-gray-700 text-sm rounded",children:s.title},s._id))})]}),a.mainImage&&e.jsx(C,{src:f(a.mainImage),alt:a.mainImage.alt||a.title,width:1200,height:675,className:"w-full rounded-lg mb-8"}),e.jsx("div",{className:"prose prose-lg max-w-none",children:e.jsx(O,{value:a.body,components:{block:{h1:({children:s})=>e.jsx("h1",{className:"text-3xl font-bold my-4",children:s}),h2:({children:s})=>e.jsx("h2",{className:"text-2xl font-bold my-4",children:s}),h3:({children:s})=>e.jsx("h3",{className:"text-xl font-bold my-3",children:s}),normal:({children:s})=>e.jsx("p",{className:"my-4",children:s})},marks:{link:({children:s,value:i})=>{const o=i.href.startsWith("/")?void 0:"noreferrer noopener";return e.jsx("a",{href:i.href,rel:o,className:"text-blue-600 hover:underline",children:s})}}}})}),a.author?.bio&&e.jsxs("div",{className:"mt-12 p-6 bg-gray-100 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"About the author"}),e.jsxs("div",{className:"flex items-start gap-4",children:[a.author.image&&e.jsx(C,{src:f(a.author.image),alt:a.author.name,width:64,height:64,className:"w-16 h-16 rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:a.author.name}),e.jsx("p",{className:"text-gray-600",children:a.author.bio})]})]})]}),e.jsx(U,{postId:a._id,postTitle:a.title})]})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Post not found"}),e.jsx(_,{to:"/",className:"text-blue-600 hover:underline",children:"Return to home"})]})})}export{ae as default};
