import{r as i}from"./react-vendor-CeN1yosF.js";class g{static instance;bookmarks=new Map;readingLists=new Map;likes=new Set;subscribers=new Set;constructor(){this.loadFromStorage()}static getInstance(){return g.instance||(g.instance=new g),g.instance}async toggleBookmark(t){const s=this.getBookmarkByPostId(t.id);if(s){this.bookmarks.delete(s.id);for(const e of this.readingLists.values())e.bookmarkIds=e.bookmarkIds.filter(r=>r!==s.id),e.updatedAt=new Date().toISOString()}else{const e={id:`bookmark-${Date.now()}-${Math.random()}`,postId:t.id,postTitle:t.title,postSlug:t.slug,postExcerpt:t.excerpt,postImage:t.mainImage,createdAt:new Date().toISOString(),tags:[],readingProgress:0};this.bookmarks.set(e.id,e)}return this.saveToStorage(),this.notifySubscribers(),!s}async toggleLike(t){return this.likes.has(t)?this.likes.delete(t):this.likes.add(t),this.saveToStorage(),this.notifySubscribers(),this.likes.has(t)}getBookmarkByPostId(t){return Array.from(this.bookmarks.values()).find(s=>s.postId===t)}getAllBookmarks(t="date"){const s=Array.from(this.bookmarks.values());switch(t){case"title":return s.sort((e,r)=>e.postTitle.localeCompare(r.postTitle));case"progress":return s.sort((e,r)=>(r.readingProgress||0)-(e.readingProgress||0));default:return s.sort((e,r)=>new Date(r.createdAt).getTime()-new Date(e.createdAt).getTime())}}getBookmarksByTag(t){return Array.from(this.bookmarks.values()).filter(s=>s.tags.includes(t))}createReadingList(t){const s={id:`list-${Date.now()}-${Math.random()}`,name:t.name,description:t.description,bookmarkIds:[],isPublic:t.isPublic||!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),color:t.color,icon:t.icon};return this.readingLists.set(s.id,s),this.saveToStorage(),this.notifySubscribers(),s}addToReadingList(t,s){const e=this.readingLists.get(t);e&&!e.bookmarkIds.includes(s)&&(e.bookmarkIds.push(s),e.updatedAt=new Date().toISOString(),this.saveToStorage(),this.notifySubscribers())}removeFromReadingList(t,s){const e=this.readingLists.get(t);e&&(e.bookmarkIds=e.bookmarkIds.filter(r=>r!==s),e.updatedAt=new Date().toISOString(),this.saveToStorage(),this.notifySubscribers())}updateReadingList(t,s){const e=this.readingLists.get(t);e&&(Object.assign(e,s),e.updatedAt=new Date().toISOString(),this.saveToStorage(),this.notifySubscribers())}deleteReadingList(t){this.readingLists.delete(t),this.saveToStorage(),this.notifySubscribers()}getAllReadingLists(){return Array.from(this.readingLists.values()).sort((t,s)=>new Date(s.updatedAt).getTime()-new Date(t.updatedAt).getTime())}getBookmarksByList(t){const s=this.readingLists.get(t);return s?s.bookmarkIds.map(e=>this.bookmarks.get(e)).filter(Boolean):[]}updateReadingProgress(t,s){const e=this.bookmarks.get(t);e&&(e.readingProgress=Math.min(100,Math.max(0,s)),e.lastReadAt=new Date().toISOString(),this.saveToStorage(),this.notifySubscribers())}addTag(t,s){const e=this.bookmarks.get(t);e&&!e.tags.includes(s)&&(e.tags.push(s),this.saveToStorage(),this.notifySubscribers())}removeTag(t,s){const e=this.bookmarks.get(t);e&&(e.tags=e.tags.filter(r=>r!==s),this.saveToStorage(),this.notifySubscribers())}updateNotes(t,s){const e=this.bookmarks.get(t);e&&(e.notes=s,this.saveToStorage(),this.notifySubscribers())}getAllTags(){const t=new Set;return this.bookmarks.forEach(s=>{s.tags.forEach(e=>t.add(e))}),Array.from(t).sort()}getStats(){const t=Array.from(this.bookmarks.values()),s=t.reduce((e,r)=>e+(r.readingProgress||0),0);return{totalBookmarks:t.length,totalLikes:this.likes.size,readingLists:this.readingLists.size,completedReading:t.filter(e=>e.readingProgress===100).length,averageReadingProgress:t.length>0?s/t.length:0}}isBookmarked(t){return Array.from(this.bookmarks.values()).some(s=>s.postId===t)}isLiked(t){return this.likes.has(t)}subscribe(t){return this.subscribers.add(t),()=>this.subscribers.delete(t)}notifySubscribers(){this.subscribers.forEach(t=>t())}loadFromStorage(){try{const t=localStorage.getItem("blog_bookmarks");if(t){const r=JSON.parse(t);this.bookmarks=new Map(Object.entries(r))}const s=localStorage.getItem("reading_lists");if(s){const r=JSON.parse(s);this.readingLists=new Map(Object.entries(r))}const e=localStorage.getItem("post_likes");e&&(this.likes=new Set(JSON.parse(e)))}catch(t){console.error("Failed to load bookmarks from storage:",t)}}saveToStorage(){try{localStorage.setItem("blog_bookmarks",JSON.stringify(Object.fromEntries(this.bookmarks))),localStorage.setItem("reading_lists",JSON.stringify(Object.fromEntries(this.readingLists))),localStorage.setItem("post_likes",JSON.stringify(Array.from(this.likes)))}catch(t){console.error("Failed to save bookmarks to storage:",t)}}}function v(){const o=g.getInstance(),[t,s]=i.useState([]),[e,r]=i.useState([]),[d,c]=i.useState(o.getStats());i.useEffect(()=>{const a=()=>{s(o.getAllBookmarks()),r(o.getAllReadingLists()),c(o.getStats())};return a(),o.subscribe(a)},[]);const l=i.useCallback(async a=>await o.toggleBookmark(a),[]),k=i.useCallback(async a=>await o.toggleLike(a),[]),u=i.useCallback(a=>o.createReadingList(a),[]),m=i.useCallback((a,n)=>{o.addToReadingList(a,n)},[]),b=i.useCallback((a,n)=>{o.updateReadingProgress(a,n)},[]),h=i.useCallback(a=>o.isBookmarked(a),[]),S=i.useCallback(a=>o.isLiked(a),[]),f=i.useCallback((a,n)=>{o.updateReadingList(a,n)},[]),L=i.useCallback(a=>{o.deleteReadingList(a)},[]),p=i.useCallback((a,n)=>{o.addTag(a,n)},[]),y=i.useCallback((a,n)=>{o.removeTag(a,n)},[]),T=i.useCallback((a,n)=>{o.updateNotes(a,n)},[]);return{bookmarks:t,readingLists:e,stats:d,toggleBookmark:l,toggleLike:k,createReadingList:u,addToReadingList:m,updateReadingProgress:b,updateReadingList:f,deleteReadingList:L,addTag:p,removeTag:y,updateNotes:T,isBookmarked:h,isLiked:S}}function w(o){const t=g.getInstance(),[s,e]=i.useState(!1),[r,d]=i.useState(!1),[c,l]=i.useState();return i.useEffect(()=>{const k=()=>{e(t.isBookmarked(o)),d(t.isLiked(o)),l(t.getBookmarkByPostId(o))};return k(),t.subscribe(k)},[o]),{isBookmarked:s,isLiked:r,bookmark:c}}g.getInstance();export{w as a,v as u};
